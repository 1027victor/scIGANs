#if 0
	shc Version 4.0.1, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -r -f src/scIGANs.sh -o scIGANs 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[4]))
	"\120\212\276\054\367\257\062\163\237\151\315\110\371\227\003\106"
	"\015\057\070\146\311\002\277"
#define      pswd_z	256
#define      pswd	((&data[57]))
	"\022\354\024\034\272\374\125\201\313\233\261\260\311\217\311\232"
	"\356\104\032\170\164\016\134\234\136\347\133\213\362\344\372\005"
	"\321\017\051\067\152\067\152\371\366\306\137\375\116\271\307\330"
	"\204\323\333\353\050\202\031\265\231\045\227\131\352\025\227\273"
	"\371\301\363\143\370\135\135\357\043\275\355\162\166\264\112\373"
	"\210\046\346\260\250\377\146\102\045\375\233\017\023\063\312\014"
	"\364\276\160\354\033\315\334\077\212\311\261\000\176\374\373\006"
	"\042\342\267\312\342\035\014\007\033\250\026\057\333\341\073\320"
	"\237\253\275\273\170\231\372\003\142\254\004\341\250\000\347\312"
	"\342\236\225\304\274\242\314\330\112\343\007\046\304\103\366\144"
	"\356\263\037\147\114\031\152\257\306\156\221\156\156\170\070\121"
	"\027\316\026\324\160\342\255\272\305\264\340\212\367\327\356\346"
	"\212\016\115\327\050\270\207\356\046\030\134\225\221\225\346\251"
	"\143\374\176\323\337\053\216\244\337\157\057\327\106\036\275\321"
	"\054\013\251\124\303\061\102\352\112\236\177\333\064\146\205\227"
	"\142\003\153\102\056\371\347\016\150\026\346\257\064\244\200\141"
	"\257\052\265\162\133\367\134\245\226\334\201\313\102\006\142\245"
	"\012\315\347\070\307\316\106\057\345\055\336\031\321\137\172\200"
	"\211\060\041\213\014\166\014\327\022\275\207\333\115\121\165\074"
	"\225\220\264\011\236\021\246\375\370\001\210\353\346\203"
#define      msg1_z	65
#define      msg1	((&data[353]))
	"\022\102\237\211\117\167\234\015\376\170\132\117\277\104\276\154"
	"\334\141\317\066\362\360\173\365\227\215\273\367\213\111\115\254"
	"\364\263\271\355\217\145\076\252\032\215\261\014\377\340\376\110"
	"\011\063\025\271\107\012\127\357\005\267\052\001\353\010\362\122"
	"\157\246\135\231\370\310\120\272\207\140\144\102\050\356\227\345"
	"\177\113\357\036\134\225"
#define      date_z	1
#define      date	((&data[427]))
	"\353"
#define      msg2_z	19
#define      msg2	((&data[429]))
	"\050\363\353\363\327\313\203\350\345\155\064\171\363\115\035\366"
	"\367\252\376\127\062\064"
#define      rlax_z	1
#define      rlax	((&data[450]))
	"\050"
#define      xecc_z	15
#define      xecc	((&data[454]))
	"\323\153\323\351\016\142\205\117\120\233\140\064\303\224\115\346"
	"\114\225\321\344\056"
#define      shll_z	10
#define      shll	((&data[474]))
	"\007\121\266\241\026\101\233\042\165\341\125\323\020\366"
#define      lsto_z	1
#define      lsto	((&data[486]))
	"\034"
#define      chk1_z	22
#define      chk1	((&data[491]))
	"\057\004\240\127\277\260\222\174\173\320\334\217\046\154\264\071"
	"\271\201\241\346\137\133\025\171\232\001"
#define      inlo_z	3
#define      inlo	((&data[513]))
	"\060\065\165"
#define      tst1_z	22
#define      tst1	((&data[517]))
	"\113\251\313\201\210\213\357\271\112\156\307\360\206\005\267\277"
	"\262\216\225\045\023\107\207\021\101"
#define      opts_z	1
#define      opts	((&data[541]))
	"\030"
#define      text_z	2675
#define      text	((&data[592]))
	"\155\330\074\277\351\063\057\126\277\272\032\342\351\036\202\101"
	"\125\127\124\322\243\303\035\264\005\324\232\030\156\255\116\334"
	"\205\212\233\157\275\312\306\175\205\340\137\156\377\342\260\125"
	"\072\004\214\017\260\317\207\057\117\141\101\206\033\223\221\036"
	"\245\233\261\175\011\014\247\050\155\103\165\046\151\122\345\063"
	"\077\054\167\203\114\207\052\210\310\347\064\352\123\325\312\350"
	"\202\255\363\160\155\207\135\027\010\152\011\360\160\374\172\254"
	"\106\271\216\037\357\215\237\107\141\304\140\334\276\125\270\144"
	"\151\074\354\200\073\103\310\054\071\141\300\355\106\005\312\023"
	"\267\215\143\135\265\240\047\300\153\276\175\306\114\370\065\026"
	"\152\336\006\370\137\300\176\010\047\112\311\007\346\260\347\060"
	"\053\235\035\103\033\147\317\344\217\311\202\173\366\166\042\203"
	"\375\156\326\131\131\175\203\034\360\321\073\114\231\131\344\014"
	"\276\177\364\223\300\114\163\330\175\265\251\131\215\255\327\130"
	"\342\235\177\130\041\107\360\055\241\125\164\311\306\300\073\271"
	"\346\220\117\233\275\170\175\046\350\264\117\332\232\024\047\024"
	"\236\161\033\146\355\062\205\237\244\334\104\261\353\371\155\347"
	"\216\047\334\103\226\057\105\264\004\220\145\157\252\217\027\156"
	"\351\141\005\254\140\072\270\032\303\135\134\121\345\342\165\214"
	"\055\142\201\305\105\371\214\125\011\221\121\013\050\320\246\026"
	"\155\202\324\151\216\027\020\114\370\344\235\065\151\216\172\125"
	"\224\337\340\340\163\354\271\234\001\167\131\202\021\135\230\273"
	"\323\216\274\175\373\266\103\074\215\131\126\275\255\252\310\205"
	"\075\064\244\133\333\071\371\375\043\036\050\372\100\304\113\265"
	"\210\231\032\321\260\161\276\330\251\221\056\243\170\351\367\202"
	"\165\337\375\014\351\023\130\177\214\357\036\061\072\177\166\233"
	"\174\071\321\335\327\063\041\367\325\132\107\120\130\044\206\043"
	"\323\174\023\022\376\035\034\061\050\014\365\142\254\343\347\064"
	"\137\106\336\324\274\253\176\321\017\334\040\214\111\127\241\010"
	"\312\366\250\220\226\014\104\146\213\157\361\163\014\245\265\121"
	"\164\117\172\254\216\357\076\314\170\145\132\020\365\137\121\046"
	"\020\355\310\140\117\033\123\214\041\301\011\130\306\020\340\142"
	"\166\232\240\245\016\073\277\312\251\155\164\137\177\237\014\156"
	"\224\144\013\345\101\016\253\016\250\204\127\217\317\324\100\105"
	"\146\240\160\215\114\310\010\176\123\332\121\161\240\350\351\361"
	"\022\007\376\300\164\214\276\314\300\223\223\341\003\123\337\231"
	"\257\136\267\201\172\162\017\323\202\344\321\322\006\230\022\074"
	"\375\003\030\155\116\026\102\300\335\064\144\200\162\313\103\032"
	"\043\051\164\177\042\067\024\125\165\234\331\135\111\230\343\044"
	"\111\213\231\020\375\377\172\227\377\171\224\034\250\371\365\004"
	"\065\004\161\335\135\165\335\130\005\063\345\055\232\223\126\241"
	"\260\170\016\313\133\331\071\335\233\144\160\313\000\020\241\004"
	"\236\202\000\024\344\011\024\345\343\153\074\331\121\376\132\232"
	"\173\032\232\177\367\205\112\263\106\002\166\146\011\124\041\151"
	"\323\004\146\222\154\321\303\047\027\004\272\046\073\217\061\116"
	"\305\216\013\007\272\254\142\342\312\316\203\017\016\026\150\032"
	"\273\077\163\253\302\063\150\031\212\320\016\022\116\112\226\047"
	"\231\331\361\041\172\264\265\171\070\214\236\177\346\100\277\237"
	"\136\112\043\357\044\341\221\135\236\027\164\340\370\257\034\162"
	"\137\053\346\235\061\212\230\360\105\263\344\201\264\215\177\074"
	"\062\216\376\233\202\164\017\112\054\371\123\365\037\345\053\307"
	"\367\336\215\200\222\111\064\160\370\061\172\116\261\374\100\136"
	"\346\173\001\034\133\130\055\133\102\344\064\024\172\100\377\116"
	"\035\171\263\232\134\045\024\310\261\164\176\255\205\143\124\332"
	"\201\151\052\253\003\205\156\141\271\366\006\350\234\151\035\365"
	"\256\204\064\075\166\153\257\076\050\314\143\256\215\064\026\017"
	"\252\036\071\151\106\003\221\200\302\010\024\176\226\356\277\005"
	"\314\114\162\164\037\375\372\072\236\125\276\051\051\242\314\306"
	"\162\074\347\244\025\046\351\227\212\244\314\273\347\116\015\116"
	"\103\104\012\274\115\036\234\272\225\176\063\207\054\347\305\074"
	"\306\031\321\074\043\323\275\202\133\254\132\006\245\014\025\014"
	"\240\073\104\246\114\106\124\105\202\027\376\236\237\155\111\360"
	"\231\372\056\044\074\346\263\151\275\031\105\262\141\130\226\056"
	"\147\254\235\100\213\040\147\256\241\345\011\166\051\076\272\157"
	"\202\220\122\062\367\133\176\327\216\153\357\361\355\335\174\222"
	"\103\206\077\033\051\064\006\374\033\110\113\365\356\237\234\046"
	"\045\235\041\347\022\125\172\153\043\050\271\035\320\055\045\021"
	"\176\042\040\333\057\274\244\026\143\041\333\025\153\114\012\335"
	"\021\324\142\055\021\170\245\010\116\333\016\241\040\317\300\270"
	"\161\142\113\267\340\275\023\357\067\261\224\210\247\337\106\152"
	"\350\125\307\262\124\110\031\130\204\362\333\336\012\013\373\304"
	"\001\262\263\126\352\141\265\362\046\016\146\060\002\217\355\032"
	"\362\343\273\144\371\221\340\361\276\276\003\012\034\302\227\050"
	"\005\330\042\301\073\036\075\250\325\203\155\022\361\070\136\302"
	"\163\334\163\037\334\350\155\342\102\342\341\155\134\054\312\113"
	"\025\077\162\117\200\052\064\205\210\325\235\374\012\140\374\314"
	"\245\360\171\321\314\351\052\141\024\252\016\253\162\257\175\140"
	"\014\357\317\127\373\332\037\327\106\010\022\154\317\301\355\160"
	"\241\350\376\337\250\106\011\076\042\055\064\246\154\111\262\374"
	"\250\323\175\015\167\267\321\116\254\354\014\136\062\247\040\143"
	"\274\131\334\171\367\135\061\024\101\004\021\051\052\365\351\105"
	"\347\336\054\073\350\214\171\271\014\356\256\271\131\066\076\314"
	"\123\066\164\026\326\245\143\211\074\070\163\052\371\275\061\316"
	"\363\017\030\313\040\207\352\376\211\031\020\152\173\032\020\223"
	"\227\021\125\321\306\064\173\057\031\130\331\115\147\037\337\260"
	"\047\271\324\226\204\213\036\164\117\027\377\012\242\141\102\041"
	"\325\230\225\166\266\335\366\174\175\200\132\007\127\027\233\172"
	"\130\032\207\014\274\030\006\110\107\332\201\321\347\042\341\220"
	"\037\055\063\345\240\033\351\070\224\130\241\344\171\127\177\101"
	"\042\073\213\043\206\345\277\307\361\046\363\311\126\042\275\024"
	"\177\073\354\262\034\376\105\045\323\127\067\016\371\240\242\164"
	"\270\307\367\144\114\242\370\213\027\353\377\101\073\046\251\342"
	"\061\146\200\352\304\120\230\230\244\313\275\161\270\220\004\254"
	"\101\016\041\151\050\117\206\203\235\342\251\021\036\073\226\303"
	"\240\237\140\252\142\011\226\344\032\163\361\237\050\160\316\155"
	"\040\317\135\233\162\245\125\334\074\000\251\123\213\256\156\351"
	"\244\146\024\052\156\021\117\102\043\264\014\250\166\257\353\125"
	"\037\313\306\347\217\167\214\030\125\277\117\364\044\341\034\236"
	"\263\155\272\236\017\221\101\134\050\357\100\377\275\150\236\330"
	"\137\322\246\253\111\363\055\174\062\111\304\226\043\217\023\041"
	"\245\160\216\047\350\115\103\264\340\121\332\101\250\242\131\307"
	"\102\055\161\301\215\052\136\322\304\020\047\022\104\247\141\020"
	"\332\016\210\170\321\320\245\172\153\221\255\013\160\144\232\335"
	"\203\071\356\074\037\047\011\364\126\213\333\023\002\323\247\051"
	"\367\375\375\216\274\241\367\011\146\122\150\307\200\124\155\212"
	"\176\353\071\150\047\014\305\376\351\166\122\221\220\156\312\332"
	"\113\307\015\255\232\032\226\107\153\013\212\026\160\016\100\165"
	"\332\217\241\006\173\237\340\175\251\312\321\300\066\176\100\331"
	"\215\116\206\135\137\350\104\171\071\071\335\300\113\003\344\350"
	"\015\262\372\152\004\327\321\354\305\005\130\376\323\360\042\072"
	"\221\053\015\336\226\372\153\146\227\166\110\060\104\346\166\056"
	"\220\260\027\211\140\210\172\361\351\136\140\025\201\157\116\253"
	"\365\246\072\154\346\275\214\373\250\345\062\300\142\111\302\051"
	"\000\164\151\043\166\105\050\043\125\072\213\366\147\065\336\172"
	"\344\242\200\231\113\270\213\171\242\277\210\125\037\276\253\074"
	"\312\003\213\300\056\223\027\112\063\232\263\132\373\127\315\164"
	"\140\164\325\324\372\130\100\364\010\073\217\065\110\251\237\231"
	"\160\232\360\102\042\112\364\313\154\034\250\304\140\362\304\365"
	"\050\345\234\175\132\241\157\315\036\250\053\140\314\051\353\122"
	"\033\105\033\063\352\010\227\203\216\360\373\114\151\035\362\106"
	"\334\213\210\374\027\130\376\205\002\032\366\325\141\015\033\107"
	"\175\171\052\127\171\155\044\377\107\205\347\364\054\145\313\216"
	"\211\131\264\265\357\040\234\031\336\042\057\023\111\024\016\366"
	"\011\335\047\303\270\072\113\073\040\327\357\172\007\130\125\165"
	"\131\031\260\265\211\342\364\054\151\354\135\341\271\156\246\366"
	"\314\327\007\043\363\033\226\116\353\167\220\027\110\005\222\237"
	"\211\330\360\212\340\367\052\060\323\134\074\155\354\177\226\210"
	"\322\270\171\265\306\062\170\247\240\164\365\373\353\116\262\100"
	"\164\166\062\003\070\373\354\307\054\277\070\206\324\331\043\325"
	"\307\312\153\330\304\261\004\220\310\005\003\227\245\210\161\223"
	"\067\275\002\334\360\041\303\102\300\215\152\235\003\266\176\146"
	"\305\133\011\236\056\307\234\064\312\312\143\133\375\001\313\073"
	"\351\275\114\263\054\127\302\025\075\062\257\345\037\127\244\346"
	"\351\350\035\344\017\234\113\246\157\114\014\273\165\324\161\235"
	"\172\067\274\130\356\230\146\271\023\005\000\000\051\060\372\375"
	"\364\200\227\157\052\146\252\012\032\017\117\202\300\143\354\013"
	"\312\361\323\125\003\232\163\032\177\120\165\376\261\223\200\017"
	"\377\105\215\175\115\063\221\233\162\213\260\356\032\153\047\204"
	"\234\156\150\212\263\016\326\172\175\314\017\305\244\115\216\060"
	"\307\026\211\055\066\114\034\157\027\312\300\152\146\070\126\311"
	"\074\376\135\246\027\350\054\303\037\022\032\230\166\044\361\372"
	"\110\302\147\040\234\054\114\236\121\320\207\330\233\306\240\316"
	"\265\244\320\006\176\115\353\265\346\157\111\076\057\102\071\035"
	"\202\364\026\357\076\174\266\015\072\313\335\246\040\272\276\054"
	"\106\012\015\130\243\376\117\106\227\261\321\130\232\112\112\206"
	"\222\177\157\232\263\206\124\033\370\377\247\355\356\200\144\077"
	"\206\321\201\027\174\230\313\075\131\207\032\312\270\023\047\271"
	"\154\253\272\132\350\144\201\377\125\012\335\342\067\241\261\272"
	"\057\244\133\113\343\362\017\374\024\110\370\361\365\166\001\170"
	"\227\141\360\160\227\214\036\240\327\217\205\102\001\065\324\054"
	"\226\133\030\362\310\014\234\224\246\041\016\353\207\164\206\150"
	"\366\307\137\241\275\126\051\167\345\140\331\216\152\366\167\037"
	"\035\174\334\024\117\144\164\176\237\275\121\362\007\361\241\175"
	"\005\225\113\354\302\267\374\052\024\360\154\365\364\374\215\004"
	"\066\111\255\155\221\010\074\275\004\253\353\236\166\247\344\227"
	"\207\036\013\206\023\315\023\065\210\107\106\245\152\041\101\013"
	"\155\103\134\320\005\103\070\174\207\161\062\104\061\352\150\241"
	"\022\022\065\163\263\230\315\136\046\312\367\331\233\246\365\364"
	"\316\233\267\113\165\030\017\251\131\075\155\227\121\121\225\315"
	"\176\252\011\223\045\334\275\143\126\336\243\207\205\363\066\037"
	"\005\042\361\177\073\262\237\245\355\020\101\032\214\254\037\327"
	"\240\070\240\163\014\100\124\045\076\166\162\210\315\070\160\376"
	"\105\173\200\031\361\156\335\304\044\133\037\233\115\341\330\067"
	"\315\012\341\050\031\123\360\050\313\357\145\276\051\024\243\206"
	"\301\207\307\263\112\066\051\176\023\303\156\120\031\261\366\133"
	"\300\176\072\154\001\224\055\205\221\050\035\060\124\355\043\251"
	"\265\062\071\365\256\234\113\044\364\215\237\243\323\274\076\111"
	"\105\235\370\300\111\212\362\077\020\304\271\251\116\216\277\240"
	"\141\172\332\136\024\026\130\245\170\101\317\313\113\027\143\172"
	"\203\060\017\007\272\242\002\336\226\027\352\116\176\110\350\165"
	"\201\006\063\035\376\047\335\307\104\222\315\030\054\345\207\331"
	"\064\144\137\276\377\316\174\312\224\371\117\165\131\276\164\073"
	"\157\312\165\163\361\123\073\066\345\010\117\021\356\326\353\042"
	"\072\112\341\072\031\135\005\256\127\125\043\260\024\230\353\203"
	"\142\141\366\124\265\062\212\232\072\331\253\051\260\227\113\352"
	"\341\054\045\373\212\053\251\341\200\314\221\225\145\175\030\307"
	"\337\017\033\224\101\246\056\174\177\332\246\057\161\361\032\123"
	"\036\100\116\250\153\367\212\354\304\033\201\051\230\232\361\167"
	"\251\015\014\353\263\072\150\063\025\016\143\207\000\176\332\037"
#define      tst2_z	19
#define      tst2	((&data[3406]))
	"\021\346\360\122\163\325\335\347\211\310\007\010\067\230\137\264"
	"\310\343\306\053\041\121"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define HARDENINGSP	0	/* Define as 1 to disable bash child process */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a processs */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;

    int lentmp = len;

#if HARDENINGSP
    //Start tracing to protect from dump & trace
    if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }

    //Decode Bash
    while (len > 0) {
        indx++;
        tmp = stte[indx];
        jndx += tmp;
        stte[indx] = stte[jndx];
        stte[jndx] = tmp;
        tmp += stte[indx];
        *ptr ^= stte[tmp];
        ptr++;
        len--;
    }

    //Exec bash script
    system(tmp2);

    //Empty script variable
    memcpy(tmp2, str, lentmp);

    //Sinal to detach ptrace
    ptrace(PTRACE_DETACH, 0, 0, 0);
    exit(0);

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
#endif /* HARDENINGSP Exit here anyway*/

    int pid, status;
    pid = fork();

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            printf("Operation not permitted\n");
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Exec bash script
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {
        wait(&status);
    }

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
} 
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
